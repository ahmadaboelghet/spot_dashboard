rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // 1. قاعدة عامة للبحث في أي مجموعة اسمها "students" (مهمة جداً للكود الجديد)
    match /{path=**}/students/{studentId} {
      allow read, write: if true;
    }

    // 2. القواعد التفصيلية للمدرسين والجروبات
    match /teachers/{teacherId}/groups/{groupId} {
      allow read, write: if true;
      
      // السماح بالوصول لكل المجموعات الفرعية (الحضور، الواجبات، الطلاب، إلخ) بشكل تلقائي
      match /{allSubcollections=**} {
        allow read, write: if true;
      }
    }

    // 3. باقي القواعد
    match /parents/{phoneNumber} { allow read, write: if true; }
    match /teachers/{teacherId} { allow read, write: if true; }
  }
}