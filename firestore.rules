rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // 1. قاعدة عامة للبحث في أي مجموعة اسمها "students" (مهمة جداً للكود الجديد)
    match /{path=**}/students/{studentId} {
      allow read, write: if true;
    }

    // 2. القواعد التفصيلية للمدرسين والجروبات
    match /teachers/{teacherId}/groups/{groupId} {
      match /dailyAttendance/{docId} { allow read, write: if true; }
      match /assignments/{docId} { allow read, write: if true; }
      match /recurringSchedules/{docId} { allow read, write: if true; }
      match /exceptions/{docId} { allow read, write: if true; }
      match /payments/{docId} { allow read, write: if true; }
      // قاعدة الطلاب العادية (احتياطي)
      match /students/{studentId} { allow read, write: if true; }
    }

    // 3. باقي القواعد
    match /parents/{phoneNumber} { allow read, write: if true; }
    match /teachers/{teacherId} { allow read, write: if true; }
    match /teachers/{teacherId}/groups/{groupId} { allow read, write: if true; }
  }
}